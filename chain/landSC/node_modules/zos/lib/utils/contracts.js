'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.bodyCode = bodyCode;
exports.constructorCode = constructorCode;
exports.splitCode = splitCode;
exports.bytecodeDigest = bytecodeDigest;
exports.flattenSourceCode = flattenSourceCode;

var _crypto = require('crypto');

var _crypto2 = _interopRequireDefault(_crypto);

var _truffleFlattener = require('truffle-flattener');

var _truffleFlattener2 = _interopRequireDefault(_truffleFlattener);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function bodyCode(instance) {
  return splitCode(instance).body;
}

function constructorCode(instance) {
  return splitCode(instance).constructor;
}

function splitCode(instance) {
  const bytecode = instance.constructor.bytecode.replace(/^0x/, '');
  const body = instance.constructor.deployedBytecode.replace(/^0x/, '');
  const constructor = bytecode.substr(0, bytecode.indexOf(body));
  return { constructor, body };
}

function bytecodeDigest(rawBytecode) {
  const bytecode = rawBytecode.replace(/^0x/, '');
  const buffer = Buffer.from(bytecode, 'hex');
  const hash = _crypto2.default.createHash('sha256');
  return hash.update(buffer).digest('hex');
}

function flattenSourceCode(contract) {
  return (0, _truffleFlattener2.default)(contract);
}